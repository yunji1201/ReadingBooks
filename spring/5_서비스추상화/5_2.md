# 5-2 트랜잭션 서비스 추상화

## 5.2.3 트랜잭션 동기화
- Q. “정기 사용자 레벨 관리 작업을 수행하는 도중에 네트워크가 끊기거나 서버에 장애 가 생겨서 작업을 완료할 수 없다면, 그때까지 변경된 사용자의 레벨은 그대로 둘까요? 아니면 모두 초기 상태로 되돌려 놓아야 할까요?”
- A. 모 아니면 도!


- 어떻게해야할까? 우선 에러를 만들어보자!
- 에러 테스트용 UserService를 상속한 클래스를 만들기 
  - 특정 시점에서 갖에로 예외가 발생하도록 만들기.

```java
static class TestUserService extends UserService {
private String id；
private TestUserService(String id) {
this.id = id； 匕수 예외를발생시킬u= 오브젝트의id를지정할수있게만든다.
}
protected void upgradeLevel(User user) {—► UserService의 메☆를오버己너이드한le if (user.getld(),equals(this.id)) throw new TestUserServiceExceptionO； super.upgradeLevel (user)； I—> 지정된 id의 us이 오브젝트가 발견되면 예외를 던져서
서 작업을 강제로 중단시킨다.
}
```

- 트랜잭션의 경계를 설정해 관리하려면?
  - Connection 파라미터 제거
    - 독립적인 트랜잭션 동기화 방식 (transaction synchronization)
    - 트랜잭션을 시작하기 위해 만든 Connection 오브젝트를 저장소에 보관 -> 호출되는 메소드에서 저장된 Connection을 가져다가 사용하게 하는 것
    - 

### • Connection 파라미터 제거

### • 트랜잭션 동기화 적용

### • 트랜잭션 테스트 보완

### • JdbcTemplate과 트랜잭션 동기화

## 5.2.4 트랜잭션 서비스 추상화

### 기술과 환경에 종속되는 트랜잭션 경계설정 코드

### 트랜잭션 API의 의존관계 문제와 해결책

### 스프링의 트랜잭션 서비스 추상화

### 트랜잭션 기술 설정의 분리

### 수직, 수평 계층구조와 의존관계